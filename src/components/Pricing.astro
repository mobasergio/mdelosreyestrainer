---
import { Check } from 'lucide-astro';

import { getCollection } from 'astro:content';

const planes = await getCollection('planes');
const planesOrdenados = planes.sort((a, b) => a.data.orden - b.data.orden);
---

<section id="pricing" class="py-24 bg-primary text-primary-foreground">
  <div class="container mx-auto px-4">
    <div class="max-w-3xl mx-auto text-center mb-16 fade-in-section">
      <h2 class="text-4xl md:text-5xl font-bold mb-6 text-balance">Planes a medida</h2>
      <p class="text-lg text-primary-foreground/80 leading-relaxed text-pretty">
        ¿Quieres entrenar por tu cuenta o prefieres tener un seguimiento detallado? Selecciona el plan que mejor se adapte a tu situación.
      </p>
    </div>

    <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
      {planesOrdenados.map((plan, index) => (
        <div class='pricing-card fade-in-section' style={`animation-delay: ${index * 0.2}s`}>
          <div class="relative flex flex-col h-full p-8 rounded-2xl bg-card text-card-foreground shadow-md">
            <div class="text-center pb-8">
              <h3 class="text-3xl text-accent font-bold mb-2">{plan.data.titulo}</h3>
              <p class="text-base text-muted-foreground">{plan.data.subtitulo}</p>
              <div class="mt-6">
                <div class="flex items-baseline justify-center gap-2">
                  <span class="text-5xl font-bold">{plan.data.precio}€</span>
                </div>
                <div class="mt-2">
                  <span class="text-sm text-muted-foreground">Pago único • 3 meses</span>
                </div>
                <div class="mt-3 pt-2 border-t border-primary-foreground/20">
                  <span class="text-2xl font-semibold">{Math.floor(plan.data.precio / 3)}€</span>
                  <span class="text-sm text-muted-foreground">/mes</span>
                </div>
              </div>
            </div>
            <ul class="space-y-3 mb-6">
              {plan.data.caracteristicas.map((feature) => (
                <li class="flex items-start gap-3">
                  <Check class="w-5 h-5 text-accent shrink-0 mt-0.5" />
                  <span class="leading-relaxed">{feature}</span>
                </li>
              ))}
            </ul>
            <div class="mt-auto pt-4">
              <a target="_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSd1SiRlewAyguSPh_dHh68VFEP-76RCJWonqxxjmrdbtl7fzA/viewform?pli=1" class={`inline-flex items-center justify-center rounded-lg text-base font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring w-full h-12 bg-accent text-accent-foreground hover:bg-accent/90`}>
                Empezar
              </a>
            </div>
          </div>
        </div>
      ))}

    </div>
  </div>
</section>

<style>
  .fade-in-section {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .fade-in-section.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .pricing-card {
    transition: transform 0.3s ease;
  }

  .pricing-card:hover {
    transform: translateY(-8px);
  }
</style>

<script>
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '-100px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
      }
    });
  }, observerOptions);

  document.querySelectorAll('.fade-in-section').forEach(el => {
    observer.observe(el);
  });

</script>
